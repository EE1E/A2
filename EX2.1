; WRITTEN BY            Ahmad Khattab
; DATE                  08/02/2014
; FILE SAVED AS         TEST.ASM
; DEVICE                PIC16F84
; OSCILLATOR            XT (4MHZ)
; WATCHDOG              DISABLED
; CODE PROTECT          OFF
; FUNCTION              OUTPUTS THE VALUE 0XF1 TO LEDS CONNECTED TO PORTB
;                       (THIS TEST PROGRAM IS USED IN PIC LABORATORY 1)
; -----------------------   EQUATES    ------------------------------------
PORTB   EQU     0X06    ;ASSIGN THE PORTB REGISTER TO THE LABEL 'PORTB'
PORTA	EQU		0X05
MCOUNT 	EQU 	0x0C
NCOUNT 	EQU 	0x0D
PORTB	EQU		0X06
RED		EQU		0X01
AMBER	EQU		0X02
GREEN	EQU		0X03
COUNT	EQU		0X0E

; ----------------------- MAIN PROGRAM ------------------------------------
        ORG     0X00    ;'ORG' SPECIFIES THE MEMORY LOCATION OF THE PROGRAM
		MOVLW	0XFF
		TRIS	PORTA
		MOVLW   0X00    ;MOVE THE VALUE 00, I.E., ALL 0'S TO W
        TRIS    PORTB   ;CONFIGURE PORTB WITH THE VALUE IN W (THE
                        ;WORKING REGISTER) 1=INPUT AND 0=OUTPUT.  
                        ;SO 00 (ALL 0'S) MAKES ALL PORTB LINES OUTPUTS.
        CLRF    PORTB   ;CLEAR THE PORTB REGISTER

LOOP
REDL    BSF		PORTB,RED
		CALL	DELAY
		BCF		PORTB,RED
		CALL 	DELAY
AMBERL	CALL	AFLASH
GREENL	BSF		PORTB,GREEN
		CALL	DELAY
		BCF		PORTB,GREEN
		CALL 	DELAY		
		
    	GOTO    LOOP



DELAY	MOVLW	0X05
		MOVWF	COUNT
DSTART	MOVLW 	0XFF	; RUNS A DELAY 
		MOVWF 	MCOUNT
GET_N	MOVLW 	0XFF
		MOVWF 	NCOUNT
DEC_N 	DECFSZ 	NCOUNT,F
		GOTO 	DEC_N
		DECFSZ 	MCOUNT,F
		GOTO 	GET_N
		DECFSZ	COUNT,1
		GOTO	DSTART
		RETURN

SDELAY	MOVLW 	0XFF	; RUNS A DELAY 
		MOVWF 	MCOUNT
GET_S	MOVLW 	0XFF
		MOVWF 	NCOUNT
DEC_S 	DECFSZ 	NCOUNT,F
		GOTO 	DEC_S
		DECFSZ 	MCOUNT,F
		GOTO 	GET_S
		RETURN

AFLASH	MOVLW	0X03
		MOVWF	COUNT
ASTART	BSF		PORTB,AMBER
		CALL	SDELAY
		BCF		PORTB,AMBER
		CALL 	SDELAY
		DECFSZ	COUNT,1
		GOTO	ASTART
		RETURN

        END

